---
// src/components/Nav.astro
import { getCollection } from 'astro:content';

// Get all pages that should appear in navigation
const pages = await Astro.glob('../pages/*.astro');

// Filter out special pages (404, index, etc.)
const navPages = pages
  .filter(page => {
    const url = page.url || '';
    return url && 
           url !== '/' && 
           !url.includes('404') &&
           !url.includes('[') // Exclude dynamic routes
  })
  .map(page => ({
    url: page.url,
    title: page.frontmatter?.title || 
           page.url?.replace('/', '').replace('-', ' ') || 
           'Untitled'
  }));

// Get collections for dropdown menus (optional)
const services = await getCollection('services');
const offers = await getCollection('offer');

const currentPath = Astro.url.pathname;
---

<div class="wrapper">
  <nav class="site_nav">
    <!-- Static pages -->
    {navPages.map(page => (
      <a 
        class={`page_link ${currentPath === page.url ? 'active' : ''}`}
        href={page.url}
      >
        {page.title}
      </a>
    ))}
    
    <!-- Services dropdown (optional - customize as needed) -->
    {services.length > 0 && (
      <div class="nav_dropdown">
        <a class="page_link dropdown_trigger" href="/services">
          Services
        </a>
        <div class="dropdown_content">
          {services.map(service => (
            <a href={`/services/${service.slug}`}>
              {service.data.title}
            </a>
          ))}
        </div>
      </div>
    )}
    
    <!-- Offers dropdown (optional - customize as needed) -->
    {offers.length > 0 && (
      <div class="nav_dropdown">
        <a class="page_link dropdown_trigger" href="/offer">
          Offers
        </a>
        <div class="dropdown_content">
          {offers.map(offer => (
            <a href={`/offer/${offer.slug}`}>
              {offer.data.title}
            </a>
          ))}
        </div>
      </div>
    )}
  </nav>
</div>

<style>
  /* Dropdown styles (optional) */
  .nav_dropdown {
    position: relative;
    display: inline-block;
  }
  
  .dropdown_content {
    display: none;
    position: absolute;
    background-color: var(--white);
    min-width: 160px;
    box-shadow: var(--card_shadow);
    z-index: 1;
  }
  
  .dropdown_content a {
    color: var(--text_color);
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }
  
  .dropdown_content a:hover {
    background-color: var(--grey_color_light);
  }
  
  .nav_dropdown:hover .dropdown_content {
    display: block;
  }
  
  .page_link.active {
    color: var(--brand_color);
    font-weight: 600;
  }
</style>