---
//import Welcome from '../components/aaa.astro';
import Layout from "@layouts/Layout.astro";

import Header from "@components/HeaderSlotted.astro";
import SocialMediaManagement from "@components/SocialMediaManagement.astro";

import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";

const posts = await getCollection("productionConcepts", ({ data }) => {
  return !import.meta.env.PROD || data.draft !== true;
});
// Sort with fallback for undefined sort_order
posts.sort((a, b) => {
  const orderA = a.data.sort_order ?? 999; // Default to 999 if undefined
  const orderB = b.data.sort_order ?? 999;
  return orderA - orderB;
});
// Render all posts content
const renderedPosts = await Promise.all(
  posts.map(async (post) => {
    const { Content } = await render(post);
    return {
      ...post,
      Content,
    };
  }),
);

// Page metadata
const pageTitle = "Junglestar | Content Production";
const pageDescription =
  "Sustainable Web Design to help fight to help the planet. Change. We help small enterprises with websites, apps, and marketing communication.";
const pageSubtitle = "Brand's Narrative? What's that...";
---

<style>
  .toc {
    color: var(--black);
    border: 1px solid var(--brand);
    border-radius: var(--radius);
    background-color: var(--whiteT25);
    a {
      color: var(--black);
      text-decoration: none;
      font-size: 90%;
      font-weight: 400;
      padding-bottom: 8px;
    }
  }
  .toc li a:nth-child(even) {
    color: red;
  }

  h1 {
    color: #111827;
  }

  .posts_container {
    margin-top: calc(var(--space_block) * 2);
  }

  .post {
    margin-bottom: calc(var(--space_block) * 2);
    padding: 2rem 0;
    border-bottom: 1px solid white;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--space_inline);
  }

  .post:last-child {
    border-bottom: none;
  }

  .post_header {
    margin-bottom: calc(var(--space_block) * 1);
  }

  .post_title {
    color: var(--brand);
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .post_subtitle {
    margin-bottom: 1rem;
    font-weight: var(--weight_med);
  }

  .post_image {
    margin: var(--space_block) 0;
    text-align: center;
    width: 400px;
  }

  .post_image img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius);
  }

  .post_content {
    max-width: 60ch;
    margin-inline: auto;
  }

  .post_content :global(ul),
  .post_content :global(ol) {
    padding-bottom: var(--space_block);
    padding-left: var(--space_inline);
  }

  .post_content :global(a) {
    color: var(--brand);
    text-decoration: underline;
  }

  .post_tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .tag {
    padding: 0.25rem 0.75rem;
    background-color: var(--whiteT25);
    border: 1px solid var(--brand);
    border-radius: calc(var(--radius) / 2);
    font-size: calc(var(--font_rem) * 0.665);
    text-transform: uppercase;
    color: var(--brand);
  }
</style>

<Layout title={pageTitle} description={pageDescription} pageSubtitle={pageSubtitle}>
  <div slot="landing_screen">
    <Header>{pageSubtitle}</Header>
  </div>

  <SocialMediaManagement />

  <!-- Posts Content -->
  <div class="wrap posts_container">
    {
      renderedPosts.map((post) => (
        <article class="post" id={post.id}>
          {post.data.image && (
            <div class="post_image">
              <Image src={post.data.image.src} alt={post.data.image.alt} width={300} height={300} />
            </div>
          )}

          <div class="post_header">
            <h3 class="post_title">{post.data.title}</h3>
            {post.data.subtitle && <p class="post_subtitle">{post.data.subtitle}</p>}

            {post.data.tags && post.data.tags.length > 0 && (
              <div class="post_tags">
                {post.data.tags.map((tag) => (
                  <span class="tag">{tag}</span>
                ))}
              </div>
            )}

            <div class="post_content">
              <post.Content />
            </div>
          </div>
        </article>
      ))
    }
  </div>

  <div class="flex flex_justify_center flex_align_center important_banner">
    <a class="button CTAbutton" href="mailto:info@junglestar.org?subject=Send me more infos about Junglestar's Design">
      Let's start talking!
    </a>
  </div>
</Layout>
