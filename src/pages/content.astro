---
import { Image } from "astro:assets";
import { getCollection, render } from "astro:content";
import Header from "@components/HeaderSlotted.astro";
import SocialMediaManagement from "@components/SocialMediaManagement.astro";
//import Welcome from '../components/aaa.astro';
import Layout from "@layouts/Layout.astro";

const posts = await getCollection("productionConcepts", ({ data }) => {
	return !import.meta.env.PROD || data.draft !== true;
});
// Sort with fallback for undefined sort_order
posts.sort((a, b) => {
	const orderA = a.data.sort_order ?? 999; // Default to 999 if undefined
	const orderB = b.data.sort_order ?? 999;
	return orderA - orderB;
});
// Render all posts content
const renderedPosts = await Promise.all(
	posts.map(async (post) => {
		const { Content } = await render(post);
		return {
			...post,
			Content,
		};
	}),
);

// Page metadata
const pageTitle = "Junglestar | Content Production";
const pageDescription =
	"Sustainable Web Design to help fight to help the planet. Change. We help small enterprises with websites, apps, and marketing communication.";
const pageSubtitle = "Brand's Narrative? What's that...";
---

<style>
  h1 {
    color: var(--black);
  }
</style>

<Layout title={pageTitle} description={pageDescription} pageSubtitle={pageSubtitle}>
  <div slot="landing_screen">
    <Header>{pageSubtitle}</Header>
  </div>

  <SocialMediaManagement />

  <!-- Posts Content -->
  <div class="wrap posts_container">
    {
      renderedPosts.map((post) => (
        <article class="post" id={post.id}>
          {post.data.image && (
            <div class="post_image">
              <Image src={post.data.image.src} alt={post.data.image.alt} width={300} height={300} />
            </div>
          )}

          <div class="post_header">
            <h3 class="post_title">{post.data.title}</h3>
            {post.data.subtitle && <p class="post_subtitle">{post.data.subtitle}</p>}

            {post.data.tags && post.data.tags.length > 0 && (
              <div class="post_tags">
                {post.data.tags.map((tag) => (
                  <span class="tag">{tag}</span>
                ))}
              </div>
            )}

            <div class="post_content">
              <post.Content />
            </div>
          </div>
        </article>
      ))
    }
  </div>

  <div class="flex flex_justify_center flex_align_center important_banner">
    <a class="button CTAbutton" href="mailto:info@junglestar.org?subject=Send me more infos about Junglestar's Design">
      Let's start talking!
    </a>
  </div>
</Layout>
